<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pomodoro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{
    --bg:#191919; /* gris Notion */
    --fg:#ffffff;
    --muted:#b3b9c4;
  }
  body {
    background: var(--bg);
    color: var(--fg);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    margin: 0;
    padding: 20px;
  }
  .timer {
    text-align: center;
    margin-top: 40px;
  }
  .time {
    font-size: clamp(44px, 14vw, 96px);
    font-weight: bold;
    line-height: 1;
  }
  .status {
    font-size: clamp(12px, 2.8vw, 18px);
    color: var(--muted);
    margin-top: 10px;
  }
</style>
</head>
<body>
  <div class="timer">
    <div class="time" id="display">30:00</div>
    <p class="status" id="status">Empieza con una tarea</p>
  </div>

<script>
  // === CONFIG ===
  const WORK = 30*60, SHORT_BREAK = 5*60, LONG_BREAK = 15*60, LONG_EVERY = 4;
  const STATE_URL = "https://api.jsonbin.io/v3/b/68dd60a0ae596e708f02af3d/latest"; // ‚ö†Ô∏è cambia <TU_BIN_ID>
  const STATE_HEADERS = {"X-Master-Key": "$2a$10$Ch2bMLEE10ANDRfOM/joselkpBQjoVe1/AZs.aylCEcpX97KlNvlq"}; // si es p√∫blico; si es privado: { "X-Master-Key": "TU_API_KEY" }

  // === ESTADO DEL POMODORO ===
  let remaining = WORK, running = false, t = null, cycles = 0, mode = "work";
  let lastAction = "none";

  const display=document.getElementById("display");
  const status=document.getElementById("status");

  function render(){
    const m = Math.floor(remaining/60), s = remaining%60;
    display.textContent = `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  }
  function tick(){
    if(remaining>0){ remaining--; render(); return; }
    clearInterval(t); running=false;

    if(mode==="work"){
      cycles++;
      if(cycles % LONG_EVERY === 0){
        mode="long"; remaining=LONG_BREAK; status.textContent="üåô Descanso largo";
      } else {
        mode="short"; remaining=SHORT_BREAK; status.textContent="‚òï Descanso corto";
      }
      start();
    } else {
      mode="work"; remaining=WORK; status.textContent="üîî Nuevo pomodoro"; start();
    }
  }
  function start(){
    if(running) return;
    running = true;
    t=setInterval(tick,1000);
    if(mode==="work") status.textContent="‚ñ∂Ô∏è En trabajo";
  }
  function pause(){
    if(!running) return;
    running=false;
    clearInterval(t);
    status.textContent="‚è∏Ô∏è Pausado";
  }
  function stop(){
    running=false;
    clearInterval(t);
    mode="work";
    remaining=WORK;
    render();
    status.textContent="Listo";
  }

  // === LEER JSONBIN (acci√≥n desde Notion/Make) ===
  async function pollState(){
    try{
      const res = await fetch(STATE_URL, { headers: STATE_HEADERS, cache: "no-store" });
      if(!res.ok) return;
      const data = await res.json();
      const action = data.record ? data.record.action : data.action;

      if(action && action !== lastAction){
        if(action==="start") start();
        if(action==="pause") pause();
        if(action==="stop")  stop();
        lastAction = action;
      }
    }catch(e){
      console.error("Error leyendo JSONBin", e);
    }
  }

  setInterval(pollState, 1500); // cada 1,5 s revisa cambios
  render();
</script>
</body>
</html>
