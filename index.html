<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pomodoro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  :root{
    --bg:#191919; /* gris Notion */
    --fg:#ffffff;
    --muted:#b3b9c4;
  }
  /* Evita scroll dentro del iframe */
  html, body {
    height: auto;
    min-height: 0;
    overflow: hidden;
    margin: 0;
    padding: 0;
    background: var(--bg);
    color: var(--fg);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  /* Contenedor fluido que respeta el alto disponible del iframe */
  .wrap{
    padding: 12px;      /* padding peque√±o para no forzar scroll */
    display: grid;
    place-items: center;
  }
  .timer{
    text-align: center;
  }
  /* Tama√±o del reloj que se adapta al ancho del iframe,
     sin pasarse (clamp: min 44px, ideal 14vw, max 96px) */
  .time{
    font-weight: 800;
    letter-spacing: 1px;
    line-height: 1;
    font-size: clamp(44px, 14vw, 96px);
    margin: 6px 0 8px 0;
  }
  .status{
    font-size: clamp(12px, 2.8vw, 18px);
    color: var(--muted);
    margin: 0;
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="timer">
      <div class="time" id="display">30:00</div>
      <p class="status" id="status">Elige una tarea</p>
    </div>
  </div>

<script>
  // Config: 30/5/15 con descanso largo cada 4
  const WORK = 30*60, SHORT_BREAK = 5*60, LONG_BREAK = 15*60, LONG_EVERY = 4;

  let remaining = WORK, running = false, t = null, cycles = 0, mode = "work";

  const display = document.getElementById("display");
  const status  = document.getElementById("status");

  function render(){
    const m = Math.floor(remaining/60), s = remaining%60;
    display.textContent = `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  }
  function tick(){
    if(remaining>0){ remaining--; render(); return; }
    clearInterval(t); running = false;

    if(mode==="work"){
      cycles++;
      if(cycles % LONG_EVERY === 0){
        mode = "long"; remaining = LONG_BREAK; status.textContent = "üåô Descanso largo";
      }else{
        mode = "short"; remaining = SHORT_BREAK; status.textContent = "‚òï Descanso corto";
      }
      start(); // auto-contin√∫a
    }else{
      mode = "work"; remaining = WORK; status.textContent = "üîî Nuevo pomodoro"; start();
    }
  }
  function start(){ if(running) return; running = true; t = setInterval(tick, 1000); if(mode==="work") status.textContent = "‚ñ∂Ô∏è En trabajo"; }
  function pause(){ if(!running) return; running = false; clearInterval(t); status.textContent = "‚è∏Ô∏è Pausado"; }
  function stop(){ running = false; clearInterval(t); mode="work"; remaining = WORK; render(); status.textContent = "Elige una tarea"; }

  // Auto-ajuste: si Notion cambia el ancho del iframe, recalcula (por si cambias columna o ancho)
  new ResizeObserver(() => { /* font-size usa clamp, no necesitamos recalcular nada m√°s */ })
    .observe(document.body);

  render();
  // Si lo controlas desde Notion/Make, deja start/pause/stop ‚Äúvac√≠os‚Äù para ser llamados externamente.
  // Si quieres que arranque solo al cargar, descomenta:
  // start();
</script>
</body>
</html>
